<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Custom Hours Persistence</title>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Supabase Configuration -->
    <script src="supabase-config.js"></script>
    <!-- Supabase Bridge -->
    <script src="supabase-bridge.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2C3E50;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
        .barber-card {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .barber-name {
            font-weight: bold;
            font-size: 18px;
            color: #2C3E50;
            margin-bottom: 10px;
        }
        .property {
            margin: 5px 0;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 3px;
        }
        .property-label {
            font-weight: 600;
            color: #666;
        }
        .true { color: #4caf50; }
        .false { color: #f44336; }
        button {
            background: #2C3E50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #34495e;
        }
        .hours-display {
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .warning {
            background: #fff3e0;
            color: #e65100;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Custom Hours Persistence Test</h1>

        <button onclick="loadBarbers()">Load All Barbers</button>
        <button onclick="testSaveCustomHours()">Test Save Custom Hours</button>
        <button onclick="testSaveStoreHours()">Test Save Store Hours</button>

        <div id="results"></div>
    </div>

    <script>
        async function initialize() {
            await SharedData.initialize();
            console.log('SharedData initialized');
            loadBarbers();
        }

        async function loadBarbers() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="test-section"><h3>Loading barbers...</h3></div>';

            try {
                const barbers = await SharedData.getBarbers();

                let html = '<div class="test-section">';
                html += '<h2>Current Barber Settings</h2>';

                barbers.forEach(barber => {
                    html += '<div class="barber-card">';
                    html += `<div class="barber-name">${barber.name}</div>`;
                    html += `<div class="property"><span class="property-label">ID:</span> ${barber.id}</div>`;
                    html += `<div class="property"><span class="property-label">Is Owner:</span> <span class="${barber.isOwner}">${barber.isOwner}</span></div>`;
                    html += `<div class="property"><span class="property-label">Uses Store Hours:</span> <span class="${barber.usesStoreHours}">${barber.usesStoreHours}</span></div>`;

                    if (barber.hours) {
                        html += '<div class="property"><span class="property-label">Custom Hours:</span></div>';
                        html += '<div class="hours-display">' + JSON.stringify(barber.hours, null, 2) + '</div>';
                    } else {
                        html += '<div class="property"><span class="property-label">Custom Hours:</span> None</div>';
                    }

                    html += '</div>';
                });

                html += '</div>';
                results.innerHTML = html;

            } catch (error) {
                results.innerHTML = `<div class="warning">Error: ${error.message}</div>`;
            }
        }

        async function testSaveCustomHours() {
            const results = document.getElementById('results');

            // Find a non-owner barber
            const barbers = await SharedData.getBarbers();
            const testBarber = barbers.find(b => !b.isOwner);

            if (!testBarber) {
                results.innerHTML += '<div class="warning">No staff barbers found to test with</div>';
                return;
            }

            // Custom hours for testing
            const customHours = {
                monday: { open: '08:00', close: '20:00', closed: false },
                tuesday: { open: '08:00', close: '20:00', closed: false },
                wednesday: { open: '08:00', close: '20:00', closed: false },
                thursday: { open: '08:00', close: '20:00', closed: false },
                friday: { open: '08:00', close: '20:00', closed: false },
                saturday: { open: '10:00', close: '22:00', closed: false },
                sunday: { closed: true }
            };

            results.innerHTML += `<div class="success">Saving custom hours for ${testBarber.name} with usesStoreHours: false...</div>`;

            await SharedData.updateBarber(testBarber.id, {
                hours: customHours,
                usesStoreHours: false
            });

            results.innerHTML += '<div class="success">Custom hours saved! Reloading barbers to verify...</div>';

            // Reload to verify
            setTimeout(loadBarbers, 1000);
        }

        async function testSaveStoreHours() {
            const results = document.getElementById('results');

            // Find a non-owner barber
            const barbers = await SharedData.getBarbers();
            const testBarber = barbers.find(b => !b.isOwner);

            if (!testBarber) {
                results.innerHTML += '<div class="warning">No staff barbers found to test with</div>';
                return;
            }

            results.innerHTML += `<div class="success">Setting ${testBarber.name} to use store hours (usesStoreHours: true)...</div>`;

            await SharedData.updateBarber(testBarber.id, {
                usesStoreHours: true
            });

            results.innerHTML += '<div class="success">Store hours setting saved! Reloading barbers to verify...</div>';

            // Reload to verify
            setTimeout(loadBarbers, 1000);
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(initialize, 500);
        });
    </script>
</body>
</html>