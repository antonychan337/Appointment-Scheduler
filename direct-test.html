<!DOCTYPE html>
<html>
<head>
    <title>Direct Test - No Cache</title>
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .error { color: red; font-weight: bold; font-size: 1.2em; }
        .success { color: green; font-weight: bold; font-size: 1.2em; }
        .warning { color: orange; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Direct Test - Force Reload</h1>
    <p>This test loads scripts with cache-busting to ensure we're testing the latest code.</p>
    <div id="results"></div>

    <script>
        // Dynamically load scripts with cache busting
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src + '?v=' + Date.now();
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        async function runTest() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Loading scripts with cache-busting...</p>';

            try {
                // Load Supabase
                await loadScript('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2');

                // Load our scripts with cache busting
                await loadScript('supabase-config.js');
                await loadScript('supabase-bridge.js');

                results.innerHTML += '<p class="success">Scripts loaded successfully</p>';

                // Wait for initialization
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Now test
                results.innerHTML += '<h2>Testing SharedData.getAvailableSlots</h2>';

                const testDate = new Date(2025, 8, 24); // Sep 24, 2025 (Wednesday)
                const serviceDuration = 30; // Men's cut

                // Call the function
                const slots = window.SharedData.getAvailableSlots(testDate, serviceDuration);

                results.innerHTML += `<p>Generated ${slots.length} slots</p>`;
                results.innerHTML += `<p>First 3: ${slots.slice(0, 3).join(', ')}</p>`;
                results.innerHTML += `<p>Last 5: ${slots.slice(-5).join(', ')}</p>`;

                // Check the last slot
                const lastSlot = slots[slots.length - 1];
                const lastSlotMinutes = window.SharedData.timeToMinutes(lastSlot);

                results.innerHTML += `<p>Last slot: ${lastSlot} (${lastSlotMinutes} minutes)</p>`;

                if (lastSlotMinutes > 1050) { // 1050 = 17:30 (5:30 PM)
                    results.innerHTML += `<p class="error">❌ ERROR: Last slot ${lastSlot} is AFTER 5:30 PM!</p>`;
                    results.innerHTML += '<p class="error">The fix didn\'t work or browser is caching old code.</p>';
                    results.innerHTML += '<p class="warning">Try: Ctrl+F5 (Windows) or Cmd+Shift+R (Mac) to hard refresh</p>';
                } else if (lastSlotMinutes === 1050) {
                    results.innerHTML += '<p class="success">✅ SUCCESS: Last slot is correctly at 5:30 PM!</p>';
                } else {
                    results.innerHTML += `<p class="warning">⚠ Last slot is at ${lastSlot}, before 5:30 PM</p>`;
                }

                // Check for any invalid slots
                const invalidSlots = slots.filter(s => window.SharedData.timeToMinutes(s) > 1050);
                if (invalidSlots.length > 0) {
                    results.innerHTML += `<p class="error">Found ${invalidSlots.length} invalid slots: ${invalidSlots.join(', ')}</p>`;
                }

            } catch (error) {
                results.innerHTML += `<p class="error">Error: ${error.message}</p>`;
            }
        }

        runTest();
    </script>
</body>
</html>